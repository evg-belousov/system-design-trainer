import type { Question } from '../types';

export const cdnQuestions: Question[] = [
  {
    id: 'sd-cdn-001',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'quiz',
    question: 'Что такое CDN (Content Delivery Network)?',
    options: [
      'Протокол шифрования трафика между клиентом и сервером',
      'Географически распределённая сеть серверов для доставки контента пользователям из ближайшей точки',
      'Система управления базами данных для хранения мультимедиа',
      'Инструмент мониторинга производительности веб-приложений',
    ],
    correctIndex: 1,
    explanation:
      'CDN (Content Delivery Network) -- это сеть географически распределённых серверов (edge-серверов, PoP -- Points of Presence), которые кэшируют и доставляют контент пользователям из ближайшей к ним точки. Это уменьшает задержку (latency), так как данные проходят меньшее расстояние, разгружает основной сервер (origin) и повышает доступность контента. CDN особенно эффективна для статического контента: изображений, видео, CSS, JavaScript, файлов для скачивания.',
  },
  {
    id: 'sd-cdn-002',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'open',
    question: 'Объясните разницу между Push CDN и Pull CDN. Когда лучше использовать каждый вариант?',
    sampleAnswer:
      'Pull CDN: edge-серверы загружают контент с origin-сервера по запросу пользователя (lazy loading). При первом запросе происходит cache miss -- контент загружается с origin, кэшируется на edge и отдаётся пользователю. Последующие запросы обслуживаются из кэша до истечения TTL. Преимущества: простая настройка, контент кэшируется только при наличии спроса, экономия хранилища на edge. Подходит для сайтов с большим объёмом контента, где не весь контент одинаково популярен. Push CDN: контент заранее загружается на edge-серверы администратором или CI/CD-пайплайном. Преимущества: нет cold start (первый запрос так же быстр, как последующие), полный контроль над версиями контента. Подходит для статических файлов, которые известны заранее (сборки фронтенда, видео), и для сайтов с небольшим, но стабильным набором контента.',
    explanation:
      'На практике большинство CDN-провайдеров (CloudFlare, AWS CloudFront, Akamai) работают по pull-модели как основной, но предоставляют API для предварительной загрузки (prefetch/warm) контента, что по сути является push-операцией. Часто используется гибридный подход: Pull CDN с предзагрузкой критически важного контента.',
  },
  {
    id: 'sd-cdn-003',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'open',
    question: 'Как CDN обрабатывает динамический контент? Какие техники используются для ускорения доставки динамических данных через CDN?',
    sampleAnswer:
      'Хотя CDN традиционно ассоциируется со статическим контентом, современные CDN активно работают с динамическим контентом через: 1) Edge Computing: выполнение серверной логики на edge-серверах (Cloudflare Workers, AWS Lambda@Edge). Позволяет генерировать персонализированный контент ближе к пользователю. 2) Dynamic Site Acceleration (DSA): оптимизация маршрутов между edge и origin через приватную сеть CDN-провайдера (в отличие от публичного интернета), persistent connections, TCP-оптимизации. 3) Edge Side Includes (ESI): разделение страницы на статические и динамические фрагменты, кэширование статических частей на edge. 4) Stale-while-revalidate: возврат устаревшего кэша при асинхронном обновлении. 5) Micro-caching: кэширование динамического контента на очень короткий TTL (1-5 секунд) для сглаживания пиков.',
    explanation:
      'Тренд в индустрии -- перемещение вычислений ближе к пользователю (edge computing). Cloudflare Workers, Deno Deploy, Vercel Edge Functions -- все они используют инфраструктуру CDN для запуска серверного кода на edge. Это размывает границу между CDN и Application Server, создавая новые архитектурные паттерны для систем с глобальной аудиторией.',
  },
  {
    id: 'sd-cdn-004',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'quiz',
    question: 'Что такое cache invalidation в контексте CDN и почему это сложная задача?',
    options: [
      'Это автоматическое удаление всех файлов с edge-серверов каждые 24 часа',
      'Это процесс удаления или обновления устаревшего контента на edge-серверах, сложный из-за распределённости и задержки распространения',
      'Это механизм шифрования кэшированного контента для защиты от атак',
      'Это процедура проверки целостности файлов на edge-серверах',
    ],
    correctIndex: 1,
    explanation:
      'Cache invalidation -- это процесс удаления или обновления устаревшего контента на edge-серверах CDN. Это одна из «двух самых сложных задач в Computer Science» (по известной цитате Фила Карлтона). Сложность в том, что CDN может иметь сотни edge-серверов по всему миру, и инвалидация должна дойти до каждого из них. Это занимает время (от секунд до минут), в течение которого разные пользователи могут получать разные версии контента. Подходы: TTL-based expiry, purge API, версионирование файлов (cache busting через хэш в имени файла, например style.abc123.css).',
  },
  {
    id: 'sd-cdn-005',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'quiz',
    question: 'Что такое PoP (Point of Presence) в контексте CDN?',
    options: [
      'Протокол передачи данных между клиентом и CDN',
      'Физическая точка присутствия CDN -- дата-центр с edge-серверами, расположенный ближе к конечным пользователям',
      'Специальный формат сжатия файлов для ускорения загрузки',
      'Механизм аутентификации пользователей на CDN',
    ],
    correctIndex: 1,
    explanation:
      'PoP (Point of Presence) -- это физическая точка присутствия CDN-провайдера, представляющая собой дата-центр или серверную стойку в определённом географическом регионе. Каждый PoP содержит edge-серверы, которые кэшируют контент и обслуживают запросы пользователей из ближайшей локации. Крупные CDN-провайдеры, такие как Cloudflare и Akamai, имеют сотни PoP по всему миру. Чем больше PoP, тем ближе контент к пользователям и тем ниже задержка.',
  },
  {
    id: 'sd-cdn-006',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'quiz',
    question: 'Какой HTTP-заголовок используется для определения, был ли ответ обслужен из кэша CDN?',
    options: [
      'Content-Type',
      'X-Cache (со значениями HIT или MISS)',
      'Authorization',
      'Accept-Encoding',
    ],
    correctIndex: 1,
    explanation:
      'Заголовок X-Cache (или аналогичные: X-Cache-Status, CF-Cache-Status у Cloudflare) используется CDN-провайдерами для информирования о статусе кэша. Значение HIT означает, что ответ был обслужен из кэша edge-сервера, MISS -- что запрос был передан на origin-сервер. Это крайне полезно для отладки и мониторинга эффективности CDN. Также используются значения EXPIRED (кэш истёк), STALE (отдан устаревший кэш) и BYPASS (кэширование обойдено).',
  },
  {
    id: 'sd-cdn-007',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'quiz',
    question: 'Какой тип контента лучше всего подходит для доставки через CDN?',
    options: [
      'Только текстовые файлы',
      'Статический контент: изображения, CSS, JavaScript, видео, шрифты',
      'Только данные из базы данных',
      'Только API-запросы с аутентификацией',
    ],
    correctIndex: 1,
    explanation:
      'CDN наиболее эффективна для доставки статического контента, который не изменяется для разных пользователей: изображения, CSS-файлы, JavaScript-бандлы, видео, шрифты, PDF-документы. Такой контент легко кэшируется на edge-серверах и может обслуживать множество пользователей без обращения к origin-серверу. Хотя современные CDN поддерживают и динамический контент (через edge computing, ESI), именно статический контент обеспечивает максимальный выигрыш от использования CDN.',
  },
  {
    id: 'sd-cdn-008',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'quiz',
    question: 'Что такое Origin Shield в архитектуре CDN?',
    options: [
      'Файрвол, защищающий origin-сервер от DDoS-атак',
      'Промежуточный кэширующий слой между edge-серверами и origin-сервером, уменьшающий нагрузку на origin',
      'Система мониторинга доступности origin-сервера',
      'Механизм шифрования данных на origin-сервере',
    ],
    correctIndex: 1,
    explanation:
      'Origin Shield -- это дополнительный кэширующий слой (mid-tier cache) между edge-серверами и origin-сервером. Без Origin Shield при cache miss каждый PoP обращается напрямую к origin, что может создать большую нагрузку, особенно при массовой инвалидации кэша. С Origin Shield все edge-серверы обращаются к одному или нескольким shield-серверам, которые кэшируют контент и снижают количество запросов к origin. Это особенно важно для сценариев с низким cache hit ratio или при «thundering herd» проблеме.',
  },
  {
    id: 'sd-cdn-009',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'quiz',
    question: 'Какую проблему решает стратегия multi-CDN?',
    options: [
      'Снижение стоимости хостинга за счёт использования бесплатных CDN',
      'Повышение надёжности, производительности и отказоустойчивости за счёт одновременного использования нескольких CDN-провайдеров',
      'Автоматическая генерация контента на edge-серверах',
      'Шифрование трафика между разными CDN-провайдерами',
    ],
    correctIndex: 1,
    explanation:
      'Multi-CDN -- это стратегия использования нескольких CDN-провайдеров одновременно. Преимущества: 1) Отказоустойчивость -- при проблемах у одного провайдера трафик переключается на другой. 2) Оптимизация производительности -- DNS-балансировка направляет пользователя к провайдеру с лучшей производительностью в его регионе. 3) Переговорная позиция -- конкуренция между провайдерами за цену. 4) Географический охват -- разные CDN могут быть сильнее в разных регионах. Реализация обычно через DNS-балансировку (Cedexis/Citrix ITM, NS1) или через CDN-агрегаторы.',
  },
  {
    id: 'sd-cdn-010',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'open',
    question: 'Какие стратегии инвалидации кэша CDN существуют? Сравните их преимущества и недостатки.',
    sampleAnswer:
      '1) TTL-based (Time to Live): контент автоматически считается устаревшим после истечения TTL. Плюсы: простота, нет активных действий. Минусы: пользователи могут видеть устаревший контент до истечения TTL. 2) Purge API: ручная или автоматическая отправка запроса на удаление конкретного URL из кэша всех edge-серверов. Плюсы: точечная инвалидация. Минусы: распространение занимает время, API-вызовы стоят денег у некоторых провайдеров. 3) Cache busting (версионирование URL): добавление хэша или версии в имя файла (style.abc123.css). Плюсы: мгновенная инвалидация, старый и новый контент сосуществуют, нет проблем с распространением. Минусы: требует изменения ссылок в HTML/коде. 4) Stale-while-revalidate: отдаётся устаревший кэш, а обновление происходит асинхронно. Плюсы: пользователь не ждёт, минимальная задержка. Минусы: кратковременное отображение старого контента. 5) Surrogate keys (теги): пометка связанных ресурсов тегами и массовая инвалидация по тегу. Плюсы: удобно для связанного контента. Минусы: поддерживается не всеми CDN.',
    explanation:
      'На практике часто комбинируются несколько подходов: cache busting для статических ассетов (CSS, JS), TTL + stale-while-revalidate для API-ответов, purge API для критических обновлений контента. Выбор стратегии зависит от требований к актуальности данных и допустимого времени рассинхронизации.',
  },
  {
    id: 'sd-cdn-011',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'open',
    question: 'Как CDN используется для защиты от DDoS-атак? Какие механизмы безопасности предоставляют современные CDN?',
    sampleAnswer:
      'CDN обеспечивает несколько уровней защиты от DDoS и других атак: 1) Поглощение объёмных атак (volumetric DDoS): распределённая сеть CDN с огромной суммарной пропускной способностью (у Cloudflare -- более 100 Тбит/с) может поглотить атаку, которая вывела бы из строя отдельный origin-сервер. 2) WAF (Web Application Firewall): фильтрация вредоносных запросов (SQL injection, XSS, CSRF) на edge-уровне до достижения origin. Правила могут быть предустановленными (OWASP Core Rule Set) и кастомными. 3) Rate limiting на edge: ограничение количества запросов с одного IP/подсети. 4) Bot management: идентификация и блокировка ботов через JavaScript-челленджи, CAPTCHA, анализ поведения. 5) IP-репутация и геоблокировка: блокировка запросов из подозрительных IP-диапазонов или регионов. 6) Anycast-маршрутизация: автоматическое распределение атакующего трафика между множеством PoP, не давая сконцентрировать атаку на одной точке. 7) SSL/TLS-терминация на edge: защита от SSL-атак без нагрузки на origin.',
    explanation:
      'Cloudflare, AWS Shield, Akamai Prolexic -- примеры CDN-сервисов с встроенной DDoS-защитой. Преимущество CDN-подхода в том, что защита работает на уровне сети, максимально близко к источнику атаки, и не требует масштабирования origin-инфраструктуры. Для критически важных приложений рекомендуется комбинировать CDN-защиту с дополнительными мерами: ограничение доступа к origin по IP, использование Private Network Connection.',
  },
  {
    id: 'sd-cdn-012',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'quiz',
    question: 'Что такое Edge Computing в контексте CDN и какое его основное преимущество?',
    options: [
      'Хранение пользовательских данных на edge-серверах вместо центральной базы данных',
      'Выполнение серверной логики (кода) на edge-серверах CDN, ближе к пользователю, для снижения задержки',
      'Использование мобильных устройств пользователей для распределённых вычислений',
      'Автоматическое масштабирование origin-сервера при высокой нагрузке',
    ],
    correctIndex: 1,
    explanation:
      'Edge Computing в контексте CDN -- это выполнение серверного кода непосредственно на edge-серверах CDN-провайдера. Примеры платформ: Cloudflare Workers (использует V8 isolates), AWS Lambda@Edge, Vercel Edge Functions, Deno Deploy. Преимущество: код выполняется в PoP, ближайшем к пользователю, что значительно снижает задержку по сравнению с обращением к централизованному origin-серверу. Типичные сценарии: A/B тестирование, персонализация контента, аутентификация, геомаршрутизация, трансформация изображений, API-прокси с кэшированием.',
  },
  {
    id: 'sd-cdn-013',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'open',
    question: 'Как CDN используется для стриминга видео? Опишите архитектуру доставки видео через CDN.',
    sampleAnswer:
      'CDN играет ключевую роль в доставке видео-контента. Архитектура включает: 1) Подготовка контента: видео транскодируется в несколько вариантов качества (битрейт, разрешение) и нарезается на короткие сегменты (2-10 сек). Используются адаптивные протоколы: HLS (HTTP Live Streaming) от Apple и DASH (Dynamic Adaptive Streaming over HTTP). 2) Хранение: сегменты и манифесты (m3u8 для HLS, mpd для DASH) хранятся на origin-сервере (часто S3 или аналог). 3) Доставка через CDN: edge-серверы кэшируют сегменты видео. При адаптивном стриминге клиент запрашивает сегменты нужного качества в зависимости от текущей пропускной способности сети. 4) Live streaming: для live-контента используется Low Latency HLS/DASH, где сегменты публикуются на CDN в реальном времени. Origin Shield критически важен для live, чтобы не перегрузить origin. 5) DRM (Digital Rights Management): CDN обрабатывает зашифрованные сегменты, а ключи расшифровки доставляются через отдельный защищённый канал.',
    explanation:
      'Netflix, YouTube, Twitch -- все используют CDN для доставки видео. Netflix построил собственную CDN (Open Connect), размещая серверы непосредственно у интернет-провайдеров. YouTube использует глобальную сеть Google. Для live-стриминга задержка является критическим параметром, и современные протоколы (LL-HLS, LL-DASH, WebRTC) стремятся к задержке менее 3 секунд.',
  },
  {
    id: 'sd-cdn-014',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'quiz',
    question: 'Что произойдёт, если CDN не имеет запрошенного файла в кэше edge-сервера?',
    options: [
      'CDN вернёт ошибку 404 пользователю',
      'CDN запросит файл у origin-сервера, закэширует его и отдаст пользователю',
      'CDN перенаправит пользователя напрямую на origin-сервер',
      'CDN автоматически сгенерирует заглушку вместо файла',
    ],
    correctIndex: 1,
    explanation:
      'Когда edge-сервер CDN не имеет запрошенного файла в кэше (cache miss), он выполняет запрос к origin-серверу, получает файл, сохраняет его в локальном кэше и отдаёт пользователю. Последующие запросы того же файла от пользователей, обслуживаемых этим же PoP, будут отданы из кэша (cache hit) без обращения к origin. Это базовый принцип работы Pull CDN. Первый пользователь испытает бо́льшую задержку (cold start), но все последующие получат контент быстрее.',
  },
  {
    id: 'sd-cdn-015',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'quiz',
    question: 'Что такое Anycast в контексте CDN и какую проблему он решает?',
    options: [
      'Протокол для передачи видео в реальном времени',
      'Метод маршрутизации, при котором один IP-адрес привязан к нескольким серверам, и запрос направляется к ближайшему',
      'Метод шифрования данных при передаче между edge-серверами',
      'Алгоритм балансировки нагрузки внутри одного дата-центра',
    ],
    correctIndex: 1,
    explanation:
      'Anycast -- это метод сетевой маршрутизации, при котором один и тот же IP-адрес объявляется (анонсируется через BGP) множеством серверов в разных географических локациях. Когда пользователь отправляет запрос на этот IP, сетевая инфраструктура автоматически направляет его к ближайшему серверу (по метрикам маршрутизации). В CDN Anycast используется для автоматического направления пользователей к ближайшему PoP без необходимости DNS-балансировки. Также Anycast эффективно распределяет DDoS-трафик по множеству точек.',
  },
  {
    id: 'sd-cdn-016',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'quiz',
    question: 'Что такое Edge Side Includes (ESI) и какую задачу они решают?',
    options: [
      'Протокол для шифрования контента на edge-серверах',
      'Язык разметки, позволяющий разделить страницу на фрагменты с разным кэшированием -- статические части кэшируются, динамические запрашиваются отдельно',
      'Инструмент для мониторинга производительности edge-серверов',
      'Формат сжатия для уменьшения размера HTML-страниц',
    ],
    correctIndex: 1,
    explanation:
      'Edge Side Includes (ESI) -- это язык разметки (стандарт W3C), который позволяет разделить веб-страницу на фрагменты с разными политиками кэширования. Например, шаблон страницы и навигация кэшируются на длительный TTL, а персонализированный блок (корзина, приветствие пользователя) подгружается отдельно с коротким TTL или без кэширования. Edge-сервер CDN собирает финальную страницу из фрагментов. Это позволяет кэшировать большую часть страницы и при этом доставлять персонализированный контент. Поддерживается Akamai, Varnish, Fastly.',
  },
  {
    id: 'sd-cdn-017',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'open',
    question: 'Что такое «thundering herd» проблема в CDN и как её решить?',
    sampleAnswer:
      'Thundering herd (проблема громоподобного стада) в CDN возникает, когда TTL популярного объекта истекает одновременно на edge-сервере, и множество пользователей одновременно запрашивают этот объект. Все запросы приводят к cache miss и одновременно уходят на origin-сервер, создавая пиковую нагрузку, которая может вывести его из строя. Решения: 1) Request collapsing (coalescing): edge-сервер объединяет несколько одновременных cache miss запросов к одному URL в один запрос к origin. Остальные клиенты ждут результат первого запроса. 2) Stale-while-revalidate: отдавать устаревший кэш пользователям, пока один фоновый запрос обновляет кэш на origin. 3) Probabilistic early expiration: кэш считается истёкшим случайно раньше TTL для небольшого процента запросов, предотвращая массовое истечение. 4) Origin Shield: дополнительный кэширующий слой, который принимает на себя поток запросов от множества edge-серверов. 5) Soft purge (Fastly): пометка объекта как stale вместо полного удаления, позволяя отдавать его при обновлении.',
    explanation:
      'Thundering herd -- одна из самых коварных проблем CDN, которая проявляется именно при высокой нагрузке. Она может каскадно усиливаться: origin не справляется, таймауты увеличиваются, edge начинает отправлять ещё больше запросов. На практике комбинация request collapsing + stale-while-revalidate + Origin Shield эффективно решает эту проблему.',
  },
  {
    id: 'sd-cdn-018',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'open',
    question: 'Какую роль играет заголовок Cache-Control в работе CDN? Приведите примеры основных директив.',
    sampleAnswer:
      'Заголовок Cache-Control указывает CDN и браузерам, как кэшировать ответ. Основные директивы: 1) max-age=3600 -- ресурс можно кэшировать на 3600 секунд (1 час). 2) s-maxage=86400 -- TTL для промежуточных кэшей (CDN), имеет приоритет над max-age для CDN. 3) public -- ресурс может кэшироваться любым кэшем (CDN, браузер). 4) private -- ресурс кэшируется только в браузере пользователя, CDN не должна его кэшировать (для персонализированных данных). 5) no-cache -- ресурс можно хранить в кэше, но перед использованием нужно проверить актуальность у сервера (revalidation). 6) no-store -- ресурс нельзя кэшировать нигде (для конфиденциальных данных). 7) stale-while-revalidate=60 -- можно отдавать устаревший кэш в течение 60 секунд, пока фоново обновляется.',
    explanation:
      'Правильная настройка Cache-Control -- ключ к эффективной работе CDN. Типичная стратегия: для статических ассетов с хэшем в имени (style.abc123.css) -- max-age=31536000 (1 год), для HTML-страниц -- no-cache или короткий max-age + stale-while-revalidate, для API-ответов -- private или s-maxage с коротким TTL.',
  },
  {
    id: 'sd-cdn-019',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'quiz',
    question: 'Какой подход к маршрутизации пользователей к ближайшему PoP CDN является наиболее точным?',
    options: [
      'Маршрутизация на основе IP-адреса клиента с использованием GeoIP-базы',
      'Маршрутизация через DNS с использованием EDNS Client Subnet (ECS) для определения реальной подсети клиента',
      'Случайная маршрутизация между доступными PoP',
      'Маршрутизация на основе User-Agent браузера',
    ],
    correctIndex: 1,
    explanation:
      'EDNS Client Subnet (ECS) -- расширение протокола DNS, при котором DNS-резолвер передаёт подсеть клиента авторитетному DNS-серверу CDN. Это позволяет CDN направить пользователя к PoP, ближайшему к его реальному местоположению, а не к местоположению DNS-резолвера. Без ECS пользователь из Москвы, использующий Google DNS (8.8.8.8, расположен в США), мог быть направлен на американский PoP. Anycast решает эту проблему на сетевом уровне, а ECS -- на уровне DNS. Комбинация обоих подходов даёт наилучший результат.',
  },
  {
    id: 'sd-cdn-020',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'open',
    question: 'Объясните, как CDN обрабатывает HTTPS-трафик. Что такое SSL/TLS-терминация на edge?',
    sampleAnswer:
      'CDN обрабатывает HTTPS-трафик следующим образом: 1) SSL/TLS-терминация на edge: edge-сервер CDN расшифровывает HTTPS-запрос от клиента, что означает, что SSL/TLS-соединение завершается на edge-сервере, а не на origin. Для этого CDN хранит SSL-сертификат и приватный ключ на edge-серверах. 2) Связь с origin: между edge и origin может использоваться отдельное HTTPS-соединение (full SSL), HTTP-соединение (flexible SSL) или strict SSL с валидацией сертификата origin. 3) Преимущества терминации на edge: снижение нагрузки на origin (SSL-хэндшейк ресурсоёмкий), возможность кэширования расшифрованного контента на edge, использование более быстрого протокола между edge и origin. 4) Варианты сертификатов: выделенный (dedicated) сертификат клиента, SAN/SNI сертификат (общий для нескольких доменов), бесплатные сертификаты Let\'s Encrypt (у Cloudflare -- Universal SSL). 5) Keyless SSL: Cloudflare предлагает вариант, где приватный ключ хранится на инфраструктуре клиента, а CDN выполняет операции SSL без доступа к ключу.',
    explanation:
      'SSL/TLS-терминация на edge -- стандартная практика для CDN. Однако она вызывает вопросы безопасности: приватный ключ должен быть распределён по всем edge-серверам. Решения: HSM (Hardware Security Modules) на edge, Keyless SSL (Cloudflare), регулярная ротация ключей. Для максимальной безопасности рекомендуется использовать full strict SSL (с валидацией сертификата origin).',
  },
  {
    id: 'sd-cdn-021',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'quiz',
    question: 'Какой основной показатель эффективности работы CDN?',
    options: [
      'Количество edge-серверов в сети',
      'Cache Hit Ratio -- процент запросов, обслуженных из кэша без обращения к origin',
      'Общий объём переданного трафика',
      'Количество поддерживаемых протоколов',
    ],
    correctIndex: 1,
    explanation:
      'Cache Hit Ratio (CHR) -- ключевой показатель эффективности CDN, показывающий процент запросов, обслуженных из кэша edge-серверов. CHR = (cache hits) / (cache hits + cache misses) * 100%. Высокий CHR (90%+) означает, что большинство запросов не доходит до origin-сервера, снижая его нагрузку и уменьшая latency для пользователей. Низкий CHR может указывать на проблемы с TTL, слишком персонализированный контент или неоптимальные Cache-Control заголовки.',
  },
  {
    id: 'sd-cdn-022',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'quiz',
    question: 'Что такое TTL (Time To Live) в контексте CDN?',
    options: [
      'Время жизни SSL-сертификата на edge-сервере',
      'Время, в течение которого контент считается актуальным и хранится в кэше edge-сервера',
      'Максимальное время ответа от origin-сервера',
      'Время установки соединения между клиентом и CDN',
    ],
    correctIndex: 1,
    explanation:
      'TTL (Time To Live) определяет, как долго контент хранится в кэше CDN до того, как будет считаться устаревшим. После истечения TTL при следующем запросе edge-сервер либо обновит контент с origin (если он изменился), либо продлит TTL (если origin вернёт 304 Not Modified). TTL задаётся через заголовки Cache-Control (max-age, s-maxage) или Expires. Правильная настройка TTL -- баланс между актуальностью данных и нагрузкой на origin.',
  },
  {
    id: 'sd-cdn-023',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'open',
    question: 'Какие преимущества даёт использование CDN для веб-сайта? Перечислите основные.',
    sampleAnswer:
      'Основные преимущества CDN: 1) Снижение задержки (latency): контент доставляется с ближайшего к пользователю edge-сервера, а не из удалённого дата-центра. 2) Разгрузка origin-сервера: большинство запросов обслуживается из кэша, снижая нагрузку на основной сервер. 3) Повышение доступности: даже при сбое origin CDN может отдавать закэшированный контент (stale-while-revalidate). 4) Защита от DDoS: распределённая сеть CDN поглощает атаки. 5) Улучшение SEO: скорость загрузки влияет на ранжирование в поисковых системах. 6) Экономия трафика: сжатие контента на edge (gzip, brotli). 7) Глобальный охват: одинаково быстрая работа сайта для пользователей по всему миру.',
    explanation:
      'Для большинства веб-сайтов с глобальной аудиторией CDN -- обязательный компонент инфраструктуры. Даже для локальных проектов CDN полезна благодаря защите от DDoS и разгрузке origin. Современные CDN (Cloudflare, AWS CloudFront) предлагают бесплатные тарифы для небольших проектов.',
  },
  {
    id: 'sd-cdn-024',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'quiz',
    question: 'Какой HTTP-заголовок указывает CDN и браузерам максимальное время кэширования для промежуточных кэшей?',
    options: [
      'max-age',
      's-maxage',
      'Expires',
      'ETag',
    ],
    correctIndex: 1,
    explanation:
      'Директива s-maxage в заголовке Cache-Control задаёт TTL специально для shared кэшей (CDN, прокси-серверы), переопределяя max-age для них. Например, Cache-Control: max-age=60, s-maxage=3600 означает: браузер кэширует на 60 секунд, а CDN -- на 3600 секунд (1 час). Это позволяет держать актуальный контент в браузере пользователя, при этом не перегружая origin частыми запросами от CDN.',
  },
  {
    id: 'sd-cdn-025',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'quiz',
    question: 'Что такое multi-CDN стратегия и какую основную проблему она решает?',
    options: [
      'Использование нескольких edge-серверов одного CDN-провайдера',
      'Одновременное использование нескольких CDN-провайдеров для повышения надёжности и производительности',
      'Разделение контента между разными доменами',
      'Многоуровневое кэширование внутри одного CDN',
    ],
    correctIndex: 1,
    explanation:
      'Multi-CDN -- стратегия использования нескольких CDN-провайдеров одновременно. Решает проблемы: 1) Отказоустойчивость -- при сбое одного провайдера трафик переключается на другой. 2) Оптимизация производительности -- разные CDN могут быть быстрее в разных регионах. 3) Избежание vendor lock-in. Реализуется через DNS-балансировку (Route53, NS1) или специализированные платформы (Cedexis). Используется крупными компаниями: Apple, LinkedIn, Hulu.',
  },
  {
    id: 'sd-cdn-026',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'open',
    question: 'Как реализовать multi-CDN архитектуру? Какие подходы к балансировке между CDN-провайдерами существуют?',
    sampleAnswer:
      'Подходы к multi-CDN балансировке: 1) DNS-based: авторитетный DNS возвращает IP разных CDN на основе геолокации, latency-метрик или весов. Инструменты: Route53 (latency-based routing), NS1 (Filter Chain), Cloudflare Load Balancing. 2) RUM-based (Real User Monitoring): сбор реальных метрик от пользователей и динамическое переключение на провайдера с лучшей производительностью. Cedexis (теперь Citrix ITM) -- лидер рынка. 3) Anycast + BGP: объявление одного IP несколькими CDN с автоматической маршрутизацией на сетевом уровне. 4) Application-level: приложение выбирает CDN-домен на основе A/B тестирования или конфигурации. Критерии выбора: latency, availability, cost (некоторые CDN дешевле для определённых регионов). Сложности: согласование кэширования между CDN, единая аналитика, управление сертификатами.',
    explanation:
      'Multi-CDN требует инвестиций в мониторинг и автоматизацию. Netflix использует собственную CDN (Open Connect) как primary и коммерческие CDN как fallback. Для большинства компаний достаточно одного надёжного CDN-провайдера с хорошим SLA.',
  },
  {
    id: 'sd-cdn-027',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'quiz',
    question: 'Как CDN определяет, какой контент можно кэшировать?',
    options: [
      'Кэширует всё содержимое без исключений',
      'Анализирует HTTP-заголовки ответа: Cache-Control, Vary, Set-Cookie и другие',
      'Кэширует только файлы определённых расширений (.js, .css, .jpg)',
      'Запрашивает у origin-сервера список кэшируемых URL',
    ],
    correctIndex: 1,
    explanation:
      'CDN принимает решение о кэшировании на основе HTTP-заголовков ответа: Cache-Control (no-store, private запрещают кэширование), Vary (определяет варианты кэша), Set-Cookie (обычно отключает кэширование), Authorization (запросы с этим заголовком не кэшируются по умолчанию). Также учитывается HTTP-метод (кэшируются только GET и HEAD) и код ответа (обычно только 200, 301, 404). CDN-провайдеры позволяют переопределять правила через настройки.',
  },
  {
    id: 'sd-cdn-028',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'open',
    question: 'Что такое Vary header и как он влияет на кэширование в CDN?',
    sampleAnswer:
      'Vary header указывает, какие заголовки запроса влияют на содержимое ответа, и CDN должна хранить отдельные версии кэша для каждой комбинации этих заголовков. Примеры: 1) Vary: Accept-Encoding -- отдельные версии для gzip, brotli, без сжатия. 2) Vary: Accept-Language -- разные языковые версии контента. 3) Vary: User-Agent -- разный контент для мобильных и десктопных браузеров (не рекомендуется из-за огромного количества вариантов). Проблемы: Vary: * или Vary с множеством заголовков фактически отключает кэширование (слишком много вариантов). Vary: Cookie -- каждый пользователь получает свою версию кэша (обычно означает, что контент не должен кэшироваться). Best practice: минимизировать Vary, использовать нормализацию (CDN приводит Accept-Encoding к стандартным значениям).',
    explanation:
      'Vary -- мощный, но опасный инструмент. Неправильное использование может привести к cache explosion (слишком много вариантов) или некорректному кэшированию (персонализированный контент отдаётся другим пользователям). Cloudflare, Fastly предоставляют функции нормализации Vary.',
  },
  {
    id: 'sd-cdn-029',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'quiz',
    question: 'Что такое prefetching (предзагрузка) в контексте CDN?',
    options: [
      'Автоматическая загрузка всех страниц сайта в кэш CDN',
      'Принудительная загрузка контента на edge-серверы до первого запроса пользователя',
      'Предсказание следующего запроса пользователя на основе ML',
      'Загрузка контента в браузер пользователя до клика',
    ],
    correctIndex: 1,
    explanation:
      'Prefetching (warming, preloading) в CDN -- это принудительная загрузка контента на edge-серверы до того, как его запросят пользователи. Это устраняет «холодный старт» (первый запрос медленнее из-за обращения к origin). Сценарии: релиз нового видео (Netflix прогревает популярный контент), деплой новой версии приложения, крупная маркетинговая кампания. Реализуется через API CDN-провайдера или специальные инструменты. Обычно прогревают контент в ключевых регионах, а не на всех PoP.',
  },
  {
    id: 'sd-cdn-030',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'open',
    question: 'Как CDN доставляет динамический контент? Опишите техники Dynamic Site Acceleration (DSA).',
    sampleAnswer:
      'Dynamic Site Acceleration (DSA) -- набор техник для ускорения доставки динамического (некэшируемого) контента через CDN: 1) Оптимизация маршрутов: CDN использует свою приватную сеть между edge и origin вместо публичного интернета, выбирая оптимальные пути с минимальной задержкой и потерей пакетов. 2) TCP-оптимизации: настройка TCP-параметров (window size, congestion control), использование TCP connection pooling между edge и origin. 3) Persistent connections: поддержание постоянных соединений с origin, устраняя overhead TCP/TLS handshake для каждого запроса. 4) HTTP/2 и HTTP/3 (QUIC): мультиплексирование запросов, сжатие заголовков. 5) Prefetch hints: edge анализирует HTML и начинает загрузку зависимых ресурсов до явного запроса. 6) Smart routing: выбор ближайшего или наименее загруженного origin-сервера. 7) Compression: сжатие ответов на edge (если origin не сжимает).',
    explanation:
      'DSA особенно эффективна для API-трафика и персонализированных страниц. Akamai утверждает, что DSA может ускорить динамический контент на 30-50%. Важно понимать, что DSA не заменяет оптимизацию самого приложения, а дополняет её сетевыми оптимизациями.',
  },
  {
    id: 'sd-cdn-031',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'quiz',
    question: 'Какой протокол используется для low-latency live streaming через CDN?',
    options: [
      'Классический HLS с сегментами по 10 секунд',
      'Low-Latency HLS (LL-HLS) или Low-Latency DASH с короткими сегментами и частичными сегментами',
      'FTP для загрузки видеофайлов',
      'WebSocket для передачи видеопотока',
    ],
    correctIndex: 1,
    explanation:
      'Low-Latency HLS (LL-HLS) и Low-Latency DASH (LL-DASH) -- протоколы для live streaming с задержкой 2-5 секунд вместо 15-30 секунд у классического HLS. Ключевые технологии: короткие сегменты (2 секунды вместо 6-10), partial segments (части сегмента публикуются до завершения), preload hints (сервер указывает следующий сегмент), blocking playlist reload. Apple представила LL-HLS в 2019 году. CDN должны поддерживать эти протоколы на уровне edge для эффективной доставки.',
  },
  {
    id: 'sd-cdn-032',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'open',
    question: 'Как обеспечить безопасность контента через CDN? Опишите механизмы защиты от несанкционированного доступа.',
    sampleAnswer:
      'Механизмы защиты контента через CDN: 1) Signed URLs/Cookies: контент доступен только по URL с криптографической подписью, включающей срок действия, IP-ограничения. Используется для платного контента, приватных файлов. 2) Token Authentication: клиент получает токен от бэкенда и передаёт его CDN для валидации. 3) Geo-blocking: ограничение доступа по географии (IP-геолокация). Используется для лицензионного контента. 4) Referrer validation: проверка заголовка Referer для предотвращения hotlinking (встраивания контента на чужих сайтах). 5) IP whitelist/blacklist: разрешение/блокировка определённых IP-диапазонов. 6) DRM (Digital Rights Management): шифрование видеоконтента с ключами, выдаваемыми лицензионным сервером. CDN доставляет зашифрованный контент, а расшифровка происходит на клиенте. 7) mTLS: взаимная TLS-аутентификация между клиентом и CDN для API.',
    explanation:
      'Выбор механизма зависит от типа контента и бизнес-требований. Для видеостриминга (Netflix, Disney+) критичен DRM. Для приватных файлов в SaaS достаточно signed URLs. Важно помнить, что referrer validation легко обходится и не должна быть единственным механизмом защиты.',
  },
  {
    id: 'sd-cdn-033',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'quiz',
    question: 'Что такое Edge Functions и какое преимущество они дают по сравнению с традиционным подходом?',
    options: [
      'Функции для мониторинга состояния edge-серверов',
      'Серверный код, выполняемый на edge-серверах CDN рядом с пользователем, минимизируя latency',
      'Функции для автоматической инвалидации кэша',
      'Инструменты для настройки правил маршрутизации CDN',
    ],
    correctIndex: 1,
    explanation:
      'Edge Functions (Cloudflare Workers, AWS Lambda@Edge, Vercel Edge Functions) позволяют выполнять серверный код непосредственно на edge-серверах CDN. Преимущества: минимальная latency (код выполняется в PoP рядом с пользователем), глобальное распределение без управления инфраструктурой, возможность модификации запросов/ответов на лету. Типичные сценарии: A/B тестирование, персонализация, аутентификация, редиректы, трансформация изображений, геомаршрутизация.',
  },
  {
    id: 'sd-cdn-034',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'quiz',
    question: 'Какой метод сжатия контента используется современными CDN для максимального уменьшения размера текстовых файлов?',
    options: [
      'ZIP',
      'Gzip',
      'Brotli',
      'LZ4',
    ],
    correctIndex: 2,
    explanation:
      'Brotli -- алгоритм сжатия, разработанный Google, обеспечивающий на 15-25% лучшее сжатие, чем gzip, при сопоставимой скорости распаковки. Особенно эффективен для текстового контента: HTML, CSS, JavaScript. Поддерживается всеми современными браузерами. CDN автоматически выбирает алгоритм на основе заголовка Accept-Encoding: br (brotli), gzip. Для изображений используются другие методы: WebP, AVIF.',
  },
  {
    id: 'sd-cdn-035',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'open',
    question: 'Как CDN оптимизирует доставку изображений? Какие техники используются?',
    sampleAnswer:
      'Техники оптимизации изображений в CDN: 1) Автоматическая конвертация форматов: преобразование в WebP/AVIF для поддерживающих браузеров (на 25-50% меньше размер при том же качестве). 2) Responsive images: генерация версий разного размера и выбор оптимального на основе Client Hints (DPR, Viewport-Width). 3) Quality optimization: адаптивное сжатие на основе типа изображения и условий сети. 4) Lazy loading hints: добавление атрибутов для отложенной загрузки. 5) Image CDN сервисы: Cloudinary, imgix, Cloudflare Images -- специализированные решения с API для трансформации (resize, crop, watermark) на лету. 6) Early hints (103): отправка preload hints до готовности основного ответа. 7) Progressive rendering: JPEG progressive, прогрессивный WebP для быстрого отображения превью.',
    explanation:
      'Изображения составляют 40-60% трафика среднего веб-сайта. Оптимизация изображений -- один из наиболее эффективных способов улучшить Core Web Vitals (LCP). Современные Image CDN могут сократить размер изображений в 3-5 раз без видимой потери качества.',
  },
  {
    id: 'sd-cdn-036',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'open',
    question: 'Опишите архитектуру CDN для video on demand (VoD) сервиса уровня Netflix. Какие компоненты необходимы?',
    sampleAnswer:
      'Архитектура VoD CDN: 1) Ingestion & Encoding: загрузка исходного видео, транскодирование в множество вариантов (bitrate ladder: 480p-4K, разные битрейты), создание адаптивных манифестов (HLS/DASH). 2) Origin Storage: объектное хранилище (S3) для сегментов видео и манифестов, часто с multi-region репликацией. 3) Origin Shield: промежуточный кэширующий слой для защиты origin от нагрузки. 4) Edge PoPs: глобальная сеть edge-серверов с кэшированием популярного контента, long-tail контент загружается по требованию. 5) Adaptive Bitrate Streaming: клиент выбирает качество на основе доступной пропускной способности, переключаясь между вариантами без прерывания. 6) DRM: Widevine, FairPlay, PlayReady для защиты контента, лицензионные серверы для выдачи ключей расшифровки. 7) Analytics: сбор метрик качества воспроизведения (rebuffering, startup time) для оптимизации. Netflix построил собственную CDN (Open Connect) с размещением серверов у ISP.',
    explanation:
      'Netflix Open Connect обслуживает 15%+ мирового интернет-трафика. Ключевая оптимизация -- размещение серверов с популярным контентом непосредственно в сетях интернет-провайдеров (IXP peering, embedded appliances), минимизируя количество сетевых hop.',
  },
  {
    id: 'sd-cdn-037',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'quiz',
    question: 'Что такое HTTP/3 (QUIC) и какое преимущество он даёт для CDN?',
    options: [
      'Новая версия HTML для ускорения рендеринга страниц',
      'Протокол на основе UDP, устраняющий head-of-line blocking и ускоряющий установку соединения',
      'Метод сжатия HTTP-заголовков',
      'Протокол для передачи больших файлов по частям',
    ],
    correctIndex: 1,
    explanation:
      'HTTP/3 (QUIC) -- протокол, работающий поверх UDP вместо TCP. Преимущества для CDN: 1) Устранение head-of-line blocking: потеря пакета в одном потоке не блокирует другие (в отличие от HTTP/2 over TCP). 2) 0-RTT connection establishment: повторное подключение без full handshake. 3) Connection migration: соединение сохраняется при смене IP (переход между Wi-Fi и мобильной сетью). 4) Встроенное шифрование. Cloudflare, Google Cloud CDN, AWS CloudFront поддерживают HTTP/3. Особенно эффективен при нестабильной сети (мобильные пользователи).',
  },
  {
    id: 'sd-cdn-038',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'quiz',
    question: 'Какую проблему решает Request Coalescing (Request Collapsing) в CDN?',
    options: [
      'Объединение нескольких маленьких файлов в один для уменьшения количества запросов',
      'Объединение одновременных cache miss запросов к одному URL в один запрос к origin',
      'Сжатие запросов для уменьшения трафика между клиентом и edge',
      'Группировка запросов от одного пользователя для приоритизации',
    ],
    correctIndex: 1,
    explanation:
      'Request Coalescing (Request Collapsing) -- техника, при которой CDN объединяет множество одновременных запросов к одному и тому же URL (при cache miss) в один запрос к origin. Остальные клиенты ждут результат первого запроса. Это критически важно для предотвращения thundering herd проблемы: когда TTL популярного объекта истекает, сотни одновременных запросов могут перегрузить origin. Varnish (grace mode), Nginx (proxy_cache_lock), CloudFront поддерживают эту функциональность.',
  },
  {
    id: 'sd-cdn-039',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'open',
    question: 'Что происходит, когда CDN-провайдер испытывает сбой? Как это влияет на доступность сайта?',
    sampleAnswer:
      'Влияние сбоя CDN на доступность: 1) Если DNS указывает на CDN (CNAME): сайт становится недоступен для пользователей, не имеющих кэша в браузере. Даже если origin работает, запросы не могут до него дойти. 2) Частичный сбой (отдельные PoP): пользователи из затронутых регионов испытывают проблемы, остальные работают нормально. 3) Degraded performance: CDN работает, но медленнее обычного. Митигации: Multi-CDN с автоматическим failover через DNS, fallback на origin через резервный домен, service workers для offline-режима критического функционала, короткий DNS TTL для быстрого переключения. Крупные CDN (Cloudflare, Akamai) имеют SLA 99.99%+, но сбои случаются (Cloudflare outage 2019, Fastly outage 2021 затронули половину интернета).',
    explanation:
      'Cloudflare outage 2 июля 2019 года на 27 минут сделал недоступными миллионы сайтов. Fastly outage 8 июня 2021 года затронул Amazon, Reddit, Twitch, The New York Times. Это напоминает о важности multi-CDN стратегии для критически важных сервисов.',
  },
  {
    id: 'sd-cdn-040',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'quiz',
    question: 'Что такое stale-while-revalidate директива в Cache-Control?',
    options: [
      'Запрет на кэширование устаревших данных',
      'Разрешение отдавать устаревший кэш пользователю, пока в фоне происходит обновление с origin',
      'Принудительная валидация каждого запроса с origin',
      'Автоматическое удаление устаревшего контента из кэша',
    ],
    correctIndex: 1,
    explanation:
      'stale-while-revalidate (SWR) позволяет CDN отдавать устаревший (stale) контент клиенту немедленно, одновременно асинхронно обновляя кэш с origin. Пример: Cache-Control: max-age=60, stale-while-revalidate=30. После истечения max-age (60 сек) в течение следующих 30 секунд CDN отдаст stale контент и запросит обновление. Преимущества: пользователь не ждёт, нет thundering herd, origin не перегружается. Это компромисс между актуальностью и скоростью.',
  },
  {
    id: 'sd-cdn-041',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'open',
    question: 'Как CDN используется для защиты от ботов? Какие техники применяются?',
    sampleAnswer:
      'Техники защиты от ботов в CDN: 1) Rate limiting: ограничение RPS с одного IP/подсети. Легитимные пользователи редко превышают разумные лимиты. 2) JavaScript challenges: отправка JS-кода, который должен выполнить браузер. Простые боты не исполняют JS. 3) CAPTCHA: визуальные или поведенческие проверки (reCAPTCHA, hCaptcha). 4) Fingerprinting: анализ характеристик браузера (canvas, WebGL, fonts) для выявления headless browsers. 5) Behavioral analysis: анализ паттернов навигации (скорость перемещения мыши, время между кликами). Машинное обучение выявляет аномалии. 6) IP reputation: базы данных известных IP-адресов ботнетов, прокси, TOR. 7) Device/browser integrity: проверка консистентности User-Agent, особенностей рендеринга. 8) Proof of Work: заставить клиента выполнить вычислительную задачу перед обслуживанием (Cloudflare Turnstile). Cloudflare Bot Management, Akamai Bot Manager -- enterprise-решения с ML.',
    explanation:
      'Боты составляют до 40% интернет-трафика. Часть из них полезны (поисковые краулеры), часть вредоносны (скраперы, credential stuffing, DDoS). Важно различать их и блокировать только вредоносных. Чрезмерно агрессивная защита может блокировать легитимных пользователей или поисковые системы.',
  },
  {
    id: 'sd-cdn-042',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'quiz',
    question: 'Что такое Tiered Distribution (многоуровневое распределение) в CDN?',
    options: [
      'Распределение контента по уровням доступа пользователей',
      'Иерархическая архитектура кэширования с несколькими уровнями между edge и origin',
      'Система ценообразования CDN по уровням трафика',
      'Разделение контента на приоритетный и обычный',
    ],
    correctIndex: 1,
    explanation:
      'Tiered Distribution (или Hierarchical Caching) -- архитектура CDN с несколькими уровнями кэширования: Edge PoPs -> Regional Shields -> Origin Shield -> Origin. Преимущества: уменьшение нагрузки на origin (запросы агрегируются на каждом уровне), улучшение cache hit ratio (региональные кэши больше и «теплее» edge), защита от thundering herd. AWS CloudFront предлагает Regional Edge Caches, Cloudflare -- Tiered Caching. Это особенно эффективно для длинного хвоста (long tail) контента с низкой популярностью.',
  },
  {
    id: 'sd-cdn-043',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'open',
    question: 'Как настроить CDN для single-page application (SPA)? Какие особенности нужно учесть?',
    sampleAnswer:
      'Настройка CDN для SPA: 1) Fallback на index.html: все несуществующие пути (клиентский роутинг) должны возвращать index.html, а не 404. Настраивается через custom error pages или edge functions. 2) Кэширование статики: JS/CSS бандлы с content hash в имени (app.a1b2c3.js) кэшируются с max-age=31536000 (1 год). 3) index.html: короткий TTL или no-cache, чтобы пользователи всегда получали актуальную версию со ссылками на новые бандлы. 4) API проксирование: настройка proxy_pass на origin для /api/* путей. 5) Preload/prefetch hints: настройка Early Hints (103) для критических ресурсов. 6) Compression: включение brotli для JS/CSS. 7) Security headers: CSP, X-Frame-Options через CDN. 8) Service Worker caching: координация между CDN и SW для оффлайн-режима.',
    explanation:
      'Типичная ошибка -- одинаковый TTL для всех файлов. index.html должен всегда проверяться с origin (или иметь очень короткий TTL), иначе пользователи не получат обновления. Кэширование статики с хэшами -- стандартная практика, позволяющая агрессивное кэширование без проблем инвалидации.',
  },
  {
    id: 'sd-cdn-044',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'junior',
    type: 'quiz',
    question: 'Какой заголовок позволяет origin-серверу указать CDN, что контент не изменился и можно продлить TTL кэша?',
    options: [
      'X-Cache: HIT',
      '200 OK с новым контентом',
      '304 Not Modified',
      'Cache-Control: must-revalidate',
    ],
    correctIndex: 2,
    explanation:
      'HTTP-код 304 Not Modified возвращается origin-сервером в ответ на условный запрос (с заголовками If-None-Match или If-Modified-Since), когда контент не изменился. CDN получает подтверждение, что кэшированная версия актуальна, и продлевает TTL без повторной загрузки тела ответа. Это экономит трафик и снижает нагрузку на origin. Механизм работает через ETag (хэш контента) или Last-Modified (дата изменения).',
  },
  {
    id: 'sd-cdn-045',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'open',
    question: 'Как CDN обрабатывает WebSocket-соединения? Какие ограничения существуют?',
    sampleAnswer:
      'WebSocket через CDN: 1) Проксирование: CDN устанавливает WebSocket-соединение с клиентом и отдельное соединение с origin, передавая сообщения в обе стороны. 2) Connection persistence: WebSocket-соединения долгоживущие, CDN должен поддерживать их без таймаута (или с настраиваемым большим таймаутом). 3) Отсутствие кэширования: WebSocket-трафик не кэшируется (real-time, двунаправленный). 4) Sticky sessions: при наличии нескольких origin-серверов важно направлять все сообщения одного соединения на один origin. 5) TLS termination: WSS (WebSocket Secure) терминируется на edge, к origin может идти WS или WSS. Ограничения: высокое потребление ресурсов (открытые соединения занимают память), ограниченное количество одновременных соединений на edge-сервер, повышенная latency из-за дополнительного hop через CDN. Cloudflare, AWS CloudFront, Fastly поддерживают WebSocket.',
    explanation:
      'Для high-scale real-time приложений (миллионы одновременных соединений) обычно используют специализированные решения (Pusher, Ably, Socket.io с Redis adapter) вместо прямого проксирования через CDN. CDN лучше подходит для moderate-scale WebSocket использования.',
  },
  {
    id: 'sd-cdn-046',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'quiz',
    question: 'Что такое Signed URLs и для чего они используются в CDN?',
    options: [
      'URL с цифровой подписью разработчика для верификации кода',
      'URL с криптографической подписью, ограничивающей доступ к контенту по времени или IP',
      'URL с встроенным SSL-сертификатом',
      'URL, подтверждающий оплату контента',
    ],
    correctIndex: 1,
    explanation:
      'Signed URLs -- механизм защиты контента, при котором доступ к ресурсу возможен только по URL с криптографической подписью. Подпись включает: срок действия (expiration), опционально IP-адрес клиента, путь к ресурсу. Бэкенд генерирует signed URL для авторизованных пользователей, CDN валидирует подпись. Используется для: платного контента (видео, документы), приватных файлов, временных ссылок на скачивание. AWS CloudFront, Google Cloud CDN, Cloudflare поддерживают signed URLs.',
  },
  {
    id: 'sd-cdn-047',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'quiz',
    question: 'Какую проблему решает Private Network Connect (или Origin Shield с защитой) в CDN?',
    options: [
      'Шифрование контента в кэше edge-серверов',
      'Защита origin-сервера от прямого доступа, разрешая подключения только от CDN',
      'Приватное соединение между разными CDN-провайдерами',
      'VPN-туннель между пользователем и CDN',
    ],
    correctIndex: 1,
    explanation:
      'Private Network Connect (AWS PrivateLink, Cloudflare Tunnel) позволяет скрыть origin-сервер от публичного интернета, разрешая подключения только от CDN через приватную сеть. Преимущества: защита от прямых DDoS-атак на origin (атакующий не знает IP), устранение необходимости в публичном IP для origin, дополнительный уровень безопасности. Origin может находиться в приватной подсети VPC без Internet Gateway.',
  },
  {
    id: 'sd-cdn-048',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'middle',
    type: 'open',
    question: 'Как правильно настроить заголовки CORS при использовании CDN?',
    sampleAnswer:
      'Настройка CORS с CDN: 1) Origin-сервер должен возвращать CORS-заголовки (Access-Control-Allow-Origin, Access-Control-Allow-Methods и др.). CDN обычно просто проксирует их. 2) Vary: Origin -- критически важен! Если ответ зависит от Origin запроса, CDN должна кэшировать отдельные версии для разных Origin. Без этого заголовка CDN может закэшировать ответ для одного домена и отдать его другому. 3) Preflight кэширование: ответы на OPTIONS-запросы также кэшируются, важен Access-Control-Max-Age для указания времени кэширования preflight. 4) Wildcard (*) vs specific origins: wildcard проще, но не работает с credentials. Для credentials нужен конкретный origin и Access-Control-Allow-Credentials: true. 5) CDN-level CORS: некоторые CDN (Cloudflare) позволяют добавлять CORS-заголовки на edge, что полезно для S3-подобных origin без настройки CORS.',
    explanation:
      'Частая ошибка -- забыть Vary: Origin, что приводит к CORS-ошибкам для части пользователей (первый запрос закэшировался с неправильным Origin). Отладка CORS-проблем через CDN сложна из-за кэширования -- используйте заголовки для отключения кэша при отладке.',
  },
  {
    id: 'sd-cdn-049',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'open',
    question: 'Что такое Real User Monitoring (RUM) в контексте CDN и как оно используется для оптимизации?',
    sampleAnswer:
      'Real User Monitoring (RUM) -- сбор метрик производительности от реальных пользователей через JavaScript-агент в браузере. Метрики: TTFB (Time To First Byte), FCP (First Contentful Paint), LCP (Largest Contentful Paint), DNS lookup time, TCP connect time, SSL handshake time, время загрузки ресурсов. Использование для CDN: 1) Multi-CDN routing: направление пользователей к CDN-провайдеру с лучшей производительностью в их регионе на основе RUM-данных. 2) PoP selection: выявление PoP с проблемами производительности. 3) Cache optimization: выявление ресурсов с низким cache hit ratio. 4) Anomaly detection: обнаружение деградации производительности в реальном времени. Инструменты: Cloudflare Web Analytics, mPulse (Akamai), SpeedCurve, New Relic Browser. RUM дополняет синтетический мониторинг реальными данными из разных сетей, устройств и географий.',
    explanation:
      'Cedexis (теперь Citrix ITM) построил бизнес на RUM-based multi-CDN routing, собирая триллионы измерений для принятия решений о маршрутизации. RUM показывает реальный user experience, который может отличаться от синтетических тестов из-за разнообразия устройств и сетевых условий.',
  },
  {
    id: 'sd-cdn-050',
    block: 'sd',
    topic: 'cdn',
    topicLabel: 'CDN',
    difficulty: 'senior',
    type: 'quiz',
    question: 'Какой подход позволяет CDN эффективно доставлять персонализированный контент без потери кэширования?',
    options: [
      'Отключение кэширования для всех персонализированных страниц',
      'Edge Side Includes (ESI) для разделения страницы на кэшируемые и динамические фрагменты',
      'Кэширование всех вариантов страницы для каждого пользователя',
      'Использование только client-side рендеринга',
    ],
    correctIndex: 1,
    explanation:
      'Edge Side Includes (ESI) позволяет разделить страницу на фрагменты с разными политиками кэширования. Статическая часть (шаблон, навигация) кэшируется на edge с длинным TTL. Персонализированные фрагменты (приветствие, корзина) загружаются отдельно с коротким TTL или без кэширования. Edge-сервер собирает финальную страницу из фрагментов. Альтернативы: client-side personalization (загрузка персонализированных данных через API после статической страницы), Edge Functions для серверной персонализации на edge.',
  },
];
